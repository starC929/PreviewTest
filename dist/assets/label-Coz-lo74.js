import{r as ref,V as inject,X as onMounted,d as resolveComponent,o as openBlock,c as createElementBlock,m as createBaseVNode,e as createVNode,f as withCtx,p as createTextVNode,q as withModifiers,h as unref,ac as ElTable,A as toDisplayString,k as withKeys}from"./index-BjGPYSck.js";import _sfc_main$1 from"./MyTag-B9LUvWb-.js";import{g as getUploadObjectMsg,u as updateUploadObjectMsg}from"./UploadObjectMsg-BBSqZrwA.js";/* empty css                                              */const _hoisted_1={id:"tablePart",style:{display:"flex","flex-direction":"column",position:"relative",height:"100%"}},_hoisted_2={id:"tablePartTop",style:{display:"flex","flex-direction":"row"}},_hoisted_3=createBaseVNode("br",null,null,-1),_hoisted_4=createBaseVNode("span",null,"请输入关键帧标签名： ",-1),_hoisted_5={class:"dialog-footer"},_sfc_main={__name:"label",props:["fileId"],setup(__props,{expose:__expose}){const fileIdProps=__props,searchLabel=ref(""),tableData=ref([]),timeFrame=ref(""),labelName=ref(""),frameLabelNameEditPage=ref(!1);let fileMsgResData={};const eventBus=inject("eventBus"),multipleTableRef=ref();let selectedOptArr=[];const maxHeight=ref("0");onMounted(()=>{maxHeight.value=String(document.getElementById("tablePart").offsetHeight-80)}),getUploadObjectMsg(fileIdProps.fileId).then(fileMsgRes=>{if(fileMsgResData=fileMsgRes.data,fileMsgRes.data.tag!==null){let arr=eval("["+fileMsgRes.data.tag+"]");tableData.value=arr}}).catch(e=>{alert("获取关键帧标签失败，请联系管理员!"),console.error("There was an error in getUploadObjectMsg!",e)}),eventBus.on("addLabel",e=>{frameLabelNameEditPage.value=!0,timeFrame.value=e}),eventBus.on("changeLabelName",()=>{eventBus.emit("markLineLabelData",getTurn())});const handleSelectionChange=(e,t)=>{selectedOptArr.length=0,selectedOptArr.push(...e),e.includes(t)||selectedOptArr.forEach((a,o)=>{a.timeFrame==t.timeFrame&&selectedOptArr.splice(o,1)}),eventBus.emit("markLineLabelData",getTurn())},handleSelectionAll=e=>{selectedOptArr.length=0,selectedOptArr.push(...e),eventBus.emit("markLineLabelData",getTurn())},getTurn=()=>{let e=[];return selectedOptArr.forEach(t=>{tableData.value.forEach(a=>{t.timeFrame===a.timeFrame&&t.labelName===a.labelName&&e.push(a)})}),e.length&&(e=deduplicate(e,"timeFrame")),e},getRowKeys=e=>e.timeFrame;function handleDelLabelData(e){e!==-1&&(tableData.value.splice(e,1),eventBus.emit("markLineLabelData",getTurn()))}function confirmInput(){let e={};e.timeFrame=timeFrame.value,e.labelName=labelName.value,tableData.value.push(e),frameLabelNameEditPage.value=!1,labelName.value="",selectedOptArr.push(e),multipleTableRef.value.toggleRowSelection(tableData.value[tableData.value.length-1],!0),eventBus.emit("markLineLabelData",getTurn())}function cancelInput(){frameLabelNameEditPage.value=!1}const deduplicate=(e,t)=>{const a=[e[0]];for(let o=1;o<e.length;o++){let n=!1;for(let r=0;r<a.length;r++)if(t&&e[o][t]===a[r][t]){n=!0;break}n||a.push(e[o])}return a};function handleRowClick(e){eventBus.emit("skipTagFrame",e.timeFrame)}function handleSaveLabel(){let e="";for(var t in tableData.value)e+="{timeFrame:"+tableData.value[t].timeFrame+", labelName:'"+tableData.value[t].labelName+"'},";e=e.slice(0,-1),fileMsgResData.tag=e,updateUploadObjectMsg(fileMsgResData).then(a=>{alert("保存成功!")}).catch(a=>{alert("保存失败，请联系管理员!"),console.error("There was an error in updateUploadObjectMsg!",a)})}function getData(){return getTurn()}return __expose({getData}),(e,t)=>{const a=resolveComponent("el-input"),o=resolveComponent("el-button"),n=resolveComponent("el-table-column"),r=resolveComponent("el-dialog");return openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createVNode(a,{modelValue:searchLabel.value,"onUpdate:modelValue":t[0]||(t[0]=l=>searchLabel.value=l),size:"media",placeholder:"输入标签名关键词搜索"},null,8,["modelValue"]),createVNode(o,{onClick:handleSaveLabel},{default:withCtx(()=>[createTextVNode("保存")]),_:1})]),createVNode(unref(ElTable),{ref_key:"multipleTableRef",ref:multipleTableRef,data:tableData.value.filter(l=>!searchLabel.value||l.labelName.toLowerCase().includes(searchLabel.value.toLowerCase())),style:{width:"20vw","margin-top":"20px","flex-grow":"1"},"header-cell-style":{textAlign:"center"},"cell-style":{textAlign:"center"},"row-key":getRowKeys,onRowClick:handleRowClick,onSelectAll:handleSelectionAll,onSelect:handleSelectionChange,"max-height":maxHeight.value},{default:withCtx(()=>[createVNode(n,{type:"selection",width:"30",style:{padding:"0px"},"reserve-selection":!0}),createVNode(n,{prop:"timeFrame",label:"时间帧",sortable:"",width:"119"}),createVNode(n,{prop:"labelName",label:"标签名",width:"140"},{default:withCtx(l=>[createVNode(_sfc_main$1,{labelName:l.row.labelName,"onUpdate:labelName":i=>l.row.labelName=i},null,8,["labelName","onUpdate:labelName"])]),_:1}),createVNode(n,{fixed:"right",label:"操作",width:"50"},{default:withCtx(l=>[createVNode(o,{icon:"Delete",style:{border:"none",color:"#f56c6c","font-size":"15px"},size:"small",onClick:withModifiers(i=>handleDelLabelData(l.$index),["stop"])},null,8,["onClick"])]),_:1})]),_:1},8,["data","max-height"])]),createVNode(r,{modelValue:frameLabelNameEditPage.value,"onUpdate:modelValue":t[2]||(t[2]=l=>frameLabelNameEditPage.value=l),title:"关键帧编辑页面",width:"500"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_5,[createVNode(o,{onClick:cancelInput},{default:withCtx(()=>[createTextVNode("取消")]),_:1}),createVNode(o,{type:"primary",onClick:confirmInput},{default:withCtx(()=>[createTextVNode(" 确认 ")]),_:1})])]),default:withCtx(()=>[createBaseVNode("span",null,"时间帧："+toDisplayString(timeFrame.value),1),_hoisted_3,_hoisted_4,createVNode(a,{modelValue:labelName.value,"onUpdate:modelValue":t[1]||(t[1]=l=>labelName.value=l),style:{width:"240px"},onKeydown:withKeys(confirmInput,["enter"])},null,8,["modelValue","onKeydown"])]),_:1},8,["modelValue"])])}}};export{_sfc_main as default};
