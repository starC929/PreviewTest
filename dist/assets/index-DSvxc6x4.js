import{U as C,_ as ce,r as w,D as y,V as ue,W as _,X as fe,Y as F,Z as me,d as v,o as x,c as Z,e as l,f as a,m as p,h as J,$ as pe,A as W,l as z,a0 as he,a1 as ge,a2 as _e,p as $,L as ve,M as we,a3 as Q,a4 as q,s as ye,t as xe}from"./index-BjGPYSck.js";import Ce from"./play-BDAjfsjQ.js";import"./缩小-KeAYSmN5.js";import"./playBar-DVjgME8t.js";import"./gaodeMap-C9aVyIDF.js";import"./echart-DBS-qq_K.js";import"./index-DnlKIcX7.js";/* empty css                                              */import"./upload-Bs9C8lXp.js";import"./label-Coz-lo74.js";import"./MyTag-B9LUvWb-.js";import"./UploadObjectMsg-BBSqZrwA.js";import"./viewSelectPanel-C4ZxGaHa.js";import"./imgPlay-Bg_UAzhR.js";import"./playSet-C-xjgyD4.js";import"./vue-draggable-plus-BQ_-Bfov.js";import"./reverseRadar-C-SKvX2h.js";import"./dataExport-Bv828Y1P.js";import"./StateMachine-wCaUvJOA.js";function be(i){return C({url:"/data/DataRecord/sshConnect",method:"post",data:i})}function Se(i){return C({url:"/data/DataRecord/sshDisconnect/"+i,method:"put"})}function E(i){return C({url:"/data/DataRecord/executeCmd",method:"post",data:i})}function Re(i){return C({url:"/data/DataRecord/bagRecordPath?path="+i,method:"put"})}function Pe(i){return C({url:"/data/DataRecord/executeDownloadCmd",method:"post",data:i})}function Ve(i){return C({url:"/data/DataRecord/getDownloadFileInfoCmd",method:"post",data:i})}const G=i=>(ye("data-v-a18ce27b"),i=i(),xe(),i),Ie={class:"layout-row"},Je={class:"header"},$e=G(()=>p("span",null," 数据录制 ",-1)),ke={style:{width:"100px","margin-left":"1%"}},De={class:"record-div"},Be={class:"layout-col"},Te=G(()=>p("br",null,null,-1)),Fe=G(()=>p("br",null,null,-1)),ze={class:"layout-right"},Ee={style:{display:"flex","flex-direction":"column","flex-grow":"1"}},Ue={class:"layout-grid"},Ke={class:"dialog-footer"},Le={__name:"index",setup(i){let j=[1,2,3,4,5,6];const k=w({width:0,height:0}),r=y({host:"127.0.0.1",port:22,user:"root",password:"",uid:0}),m=y({connState:0,downloadPath:"/home/sgmw-ruoyi/uploadPath/",cmdResult:"",recordIcon:0}),o=y({recordCtrlJsonPath:"/userdata/deploy/main_data/recordCtrl.json",recording:"",path:""}),u=y({vechile:"0.00 KB",local:"0.00 KB"});let b=w(null),S=w(null),R=w(null);const g=y({startRecord:`echo '{"recording":"true","path":""}' > /userdata/deploy/main_data/recordCtrl.json`,showRecordJson:"cat /userdata/deploy/main_data/recordCtrl.json",endRecord:"sed -i 's/true/false/g' /userdata/deploy/main_data/recordCtrl.json",newEndRecord:`echo '{"recording":"false","path":"${o.path}"}' > ${o.recordCtrlJsonPath}`}),f=y({type:"success",disabled:!1,text:"连接板子"}),d=y({type:"primary",disabled:!0,text:"开始录制"}),P=w(!1),ee=w([]),H=w(!0),A=ue("eventBus");A.on("ws-ssh",e=>{if(e.msg=="ws-disconn")V(),_.warning("websocket已断开");else if(e.msg=="conn")e.connState!=m.connState&&e.connState==2&&(m.connState=e.connState,f.type="danger",f.disabled=!1,f.text="断开连接",_.success("连接成功"),D(),setTimeout(()=>{o.recording=="true"?X():o.recording=="false"&&o.path!=""&&M()},2e3));else if(e.msg=="disconn")e.connState!=m.connState&&e.connState==0&&(V(),_.warning("连接已断开"));else if(e.msg=="cmd"){if(e.data.indexOf("recording")!==-1){let s=JSON.parse(e.data);o.recording=s.recording,o.path=s.path,console.log("recordCtrl:",o),o.recording=="true"?(console.log("处于录制状态"),m.recordIcon=2,d.disabled=!1,d.type="warning",d.text="停止录制",Re(o.path),o.path==""&&(u.vechile="null")):o.recording=="false"&&(console.log("处于非录制状态"),m.recordIcon=1,d.disabled=!1,d.type="primary",d.text="开始录制")}else if(e.data.indexOf(r.user)!==-1&&e.data.indexOf(`${o.path}`)!==-1){let s=e.data.split(" ");if(s=s.filter(n=>n!==""),s[4]!=null&&s[4]!=""){var t=new RegExp("^[-\\+]?([0-9]+\\.?)?[0-9]+$");if(t.test(s[4])){let n=Y(s[4]);u.vechile=n}else u.vechile="null"}}}}),fe(()=>{let e=document.querySelector(".layout-row").offsetWidth,t=document.querySelector(".panel-left").offsetWidth;U.value=e-t;let s=document.querySelector(".layout-row").offsetHeight;k.value.width=(U.value-260-60)/3,k.value.height=(s-50-100)/2;let n=F().getDataReocordParam();n.host!=""&&(r.host=n.host),n.user!=""&&(r.user=n.user),r.password=n.password,n.recordCtrlJsonPath!=""&&(o.recordCtrlJsonPath=n.recordCtrlJsonPath,g.startRecord=`echo '{"recording":"true","path":""}' > ${o.recordCtrlJsonPath}`,g.showRecordJson=`cat ${o.recordCtrlJsonPath}`,g.endRecord=`sed -i 's/true/false/g' ${o.recordCtrlJsonPath}`),V()});const U=w(0);me(()=>{A.off("ws-ssh"),V()});function te(){P.value=!1,g.startRecord=`echo '{"recording":"true","path":""}' > ${o.recordCtrlJsonPath}`,g.showRecordJson=`cat ${o.recordCtrlJsonPath}`,g.endRecord=`sed -i 's/true/false/g' ${o.recordCtrlJsonPath}`;let e={host:r.host,user:r.user,password:r.password,recordCtrlJsonPath:o.recordCtrlJsonPath};F().setDataReocordParam(e),_.success("更新设置")}async function oe(){if(f.disabled=!0,H.value=!1,m.connState!=2)r.host=r.host.trim(),r.uid=F().getUid(),F().setSshHost(r.host),await be(r),setTimeout(()=>{f.disabled&&(f.disabled=!1,_.error("连接失败，已超时，请检查ip地址是否正确，网络/板子是否正常"))},5e3);else{if(d.text=="停止录制"){_.error("请先停止录制在断开链接"),f.disabled=!1;return}(await Se(r.uid)).msg=="ssh断开"&&(V(),_.warning("ssh已断开"))}}async function le(){_.warning(d.text),d.text=="开始录制"?(d.disabled=!0,L(),ae()):d.text=="停止录制"&&(d.disabled=!0,K(),N(),re())}function ae(){b.value||(b.value=setInterval(async()=>{if(o.recording=="false"){console.log("开始录制定时器执行内容执行内容111111发送true");let e={cmd:g.startRecord};await E(e),setTimeout(()=>{D()},1e3)}else o.recording=="true"&&(K(),X())},2e3))}function K(){b.value&&(clearInterval(b.value),b.value=null)}function re(){S.value||(S.value=setInterval(async()=>{if(o.recording=="true"){console.log("停止录制定时器执行内容++++++++++发送false");let e={cmd:g.endRecord};await E(e),setTimeout(()=>{D()},1e3)}else o.recording=="false"&&(L(),N(),M())},2e3))}function L(){S.value&&(clearInterval(S.value),S.value=null)}function X(){R.value||(R.value=setInterval(async()=>{o.recording=="true"&&(o.path!=""?M():D())},2e3))}function N(){R.value&&(clearInterval(R.value),R.value=null)}async function se(){if(d.text=="停止录制"){_.error("请先停止录制再下载");return}let e={cmd:"scp "+r.user+"@"+r.host+`:${o.path} ${m.downloadPath}`};await Pe(e),q.warning({title:"提示",message:"开始下载"}),u.local="0.00 KB";let t=setInterval(async()=>{ne(),u.vechile=="null"||u.vechile=="0.00 KB"?(q.error({title:"提示",message:"下载错误"}),clearInterval(t)):u.vechile==u.local&&(q.success({title:"提示",message:"下载完成"}),clearInterval(t))},2e3)}function D(){let e={cmd:g.showRecordJson};console.log("查看录制配置信息:"+e.cmd),E(e)}function M(){let e={cmd:`ls -l ${o.path}`};console.log("查看车端文件大小:"+e.cmd),E(e)}async function ne(){let e=o.path.split("/"),t=e[e.length-1],s={cmd:`ls -l ${m.downloadPath}/`+t};console.log("查看本地文件大小:"+s.cmd);let h=(await Ve(s)).msg.split(" ");if(h=h.filter(I=>I!==""),h[4]!=null&&h[4]!=""){var B=new RegExp("^[-\\+]?([0-9]+\\.?)?[0-9]+$");if(B.test(h[4])){let I=Y(h[4]);u.local=I}else u.local="null"}}function Y(e){if(e<1024)return e+"B";if(e<1024*1024){var t=e/1024;return t=t.toFixed(2),t+"KB"}else if(e<1024*1024*1024){var t=e/1048576;return t=t.toFixed(2),t+"MB"}else{var t=e/1073741824;return t=t.toFixed(2),t+"GB"}}function V(){console.log("参数初始化"),m.connState=0,m.recordIcon=0,o.recording="",u.vechile="0.00 KB",u.local="0.00 KB",f.type="success",f.disabled=!1,f.text="点击连接",d.type="primary",d.disabled=!0,d.text="开始录制",K(),L(),N()}return(e,t)=>{const s=v("el-button"),n=v("el-form-item"),h=v("el-icon"),B=v("el-form"),I=v("el-card"),O=v("el-skeleton-item"),de=v("el-skeleton"),T=v("el-input"),ie=v("el-dialog");return x(),Z("div",Ie,[l(I,{class:"panel-left"},{header:a(()=>[p("div",Je,[$e,l(s,{type:"primary",plain:"",icon:J(pe),class:"button-edit",onClick:t[0]||(t[0]=c=>P.value=!0)},null,8,["icon"])])]),default:a(()=>[l(B,{style:{width:"100%","margin-top":"30px"},"label-width":"120px",size:"large"},{default:a(()=>[l(n,{label:""}),l(n,{label:"录制文件大小："},{default:a(()=>[p("label",ke,W(u.vechile),1)]),_:1}),l(n,{label:"录制状态："},{default:a(()=>[p("div",De,[m.recordIcon==0?(x(),z(h,{key:0,size:30,color:"gray"},{default:a(()=>[l(J(he))]),_:1})):m.recordIcon==1?(x(),z(h,{key:1,size:30,color:"brown"},{default:a(()=>[l(J(ge))]),_:1})):(x(),z(h,{key:2,size:30,color:"green"},{default:a(()=>[l(J(_e))]),_:1}))])]),_:1}),p("div",Be,[l(s,{class:"button-record",type:f.type,onClick:oe,disabled:f.disabled},{default:a(()=>[$(W(f.text),1)]),_:1},8,["type","disabled"]),Te,l(s,{class:"button-record",type:d.type,onClick:le,disabled:d.disabled},{default:a(()=>[$(W(d.text),1)]),_:1},8,["type","disabled"]),Fe,l(s,{class:"button-record",type:"primary",onClick:se},{default:a(()=>[$("文件下载")]),_:1})])]),_:1})]),_:1}),p("div",{class:"panel-right",style:Q(`width:${U.value}px`)},[l(de,{style:{width:"100%",height:"100%"},loading:H.value,animated:""},{template:a(()=>[p("div",ze,[l(O,{variant:"rect",style:{width:"180px",height:"100%","margin-right":"20px"}}),p("div",Ee,[l(O,{variant:"rect",style:{height:"50px","margin-bottom":"20px"}}),p("div",Ue,[(x(!0),Z(ve,null,we(J(j),c=>(x(),z(O,{key:c,style:Q(`width:${k.value.width}px;height:${k.value.height}px;margin:10px`)},null,8,["style"]))),128))])])])]),default:a(()=>[l(Ce,{files:ee.value},null,8,["files"])]),_:1},8,["loading"])],4),l(ie,{modelValue:P.value,"onUpdate:modelValue":t[7]||(t[7]=c=>P.value=c),title:"基础设置",width:"600",center:""},{footer:a(()=>[p("div",Ke,[l(s,{onClick:t[5]||(t[5]=c=>P.value=!1)},{default:a(()=>[$("取消")]),_:1}),l(s,{type:"primary",onClick:t[6]||(t[6]=c=>te())},{default:a(()=>[$("确认")]),_:1})])]),default:a(()=>[l(B,null,{default:a(()=>[l(n,{label:"host:","label-width":"120px"},{default:a(()=>[l(T,{modelValue:r.host,"onUpdate:modelValue":t[1]||(t[1]=c=>r.host=c),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(n,{label:"user:","label-width":"120px"},{default:a(()=>[l(T,{modelValue:r.user,"onUpdate:modelValue":t[2]||(t[2]=c=>r.user=c),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(n,{label:"password:","label-width":"120px"},{default:a(()=>[l(T,{modelValue:r.password,"onUpdate:modelValue":t[3]||(t[3]=c=>r.password=c),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(n,{label:"配置文件路径: ","label-width":"120px"},{default:a(()=>[l(T,{modelValue:o.recordCtrlJsonPath,"onUpdate:modelValue":t[4]||(t[4]=c=>o.recordCtrlJsonPath=c),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},st=ce(Le,[["__scopeId","data-v-a18ce27b"]]);export{st as default};
