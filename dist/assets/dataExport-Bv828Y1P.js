import{d as E,c as j}from"./upload-Bs9C8lXp.js";import{r as D,X as O,d as m,o as U,c as k,e as p,f as u,p as y,m as N}from"./index-BjGPYSck.js";const R={style:{"text-align":"center"}},I={__name:"dataExport",setup(L){const d=D([]),g=D([]),h=D(1),f=D("");O(()=>{x()});async function x(){try{(await E()).data.forEach(async t=>{let a={value:t,label:t,disabled:!1,children:[]};if(t=="EgoVehicleCanInfo")try{let{data:e}=await j(t);Object.keys(e[0].data).forEach(async o=>{if(o!=="stamp"&&o!=="seq"){let n={value:o,label:o};a.children.push(n)}})}catch(e){console.error("There was an error in getTopicData!",e)}g.value.push(a)})}catch(l){console.error("There was an error in getTopic!",l)}}async function T(){if(f.value==="")return alert("文件名不能为空");console.log("selectedSignal",d.value);let l=[],t=[],a=[],e=[];for(var r in d.value)d.value[r].length===2&&(t.push(d.value[r][0]),a.push(d.value[r][1]));l=Array.from(new Set(t)),await j(l[0]).then(i=>{e.push({topicName:l,topicData:i.data})}).catch(i=>{alert("获取数据失败，请联系管理员!"),console.error("There was an error in getTopicData!",i)}),console.log("topicDataObj",e);let o=[];if(h.value===1){for(var n in e[0].topicData){let _=[];_.push(e[0].topicData[n].timestamp);for(var c in a)_.push(e[0].topicData[n].data[a[c]]);o.push(_)}let i=f.value+".csv",b=[];b.push("timestamp");for(var c in a)b.push(a[c]);C(i,b,o)}else if(h.value===2){let i="timestamp";for(var c in a)i+=","+a[c];o.push(i);for(var n in e[0].topicData){let w="";w=e[0].topicData[n].timestamp.toString();for(var c in a)w+=","+e[0].topicData[n].data[a[c]];o.push(w)}let b=o.join(`\r
`);V(b,f.value)}else if(h.value===3){let i=[];for(var s in e[0].topicData[0].data)e[0].topicData[0].data.hasOwnProperty(s)&&i.push(s);console.log("tempSigNameArr",i);for(var n in e[0].topicData)for(var v in i)a.indexOf(i[v])===-1&&delete e[0].topicData[n].data[i[v]];console.log("topicDataObj[0].topicData",e[0].topicData);for(var c in e[0].topicData)o.push(e[0].topicData[c]);F(o,f.value)}}function S(){let l=[];d.value.forEach(t=>{l.push(t[0])}),l=Array.from(new Set(l)),l.length!==0?g.value.forEach(t=>{l[0]!==t.label&&(t.disabled=!0)}):g.value.forEach(t=>{t.disabled=!1})}const C=(l,t,a)=>{const e=[];let r="";for(let s=0;s<t.length;s++)r+=`${t[s]},`;e.push(r);for(let s=0;s<a.length;s++){let v="";for(let i=0;i<a[s].length;i++)v+=`${a[s][i]},`;e.push(v)}const o=new Blob(["\uFEFF"+e.join(`
`)],{type:"text/csv;"}),n=URL.createObjectURL(o),c=document.createElement("a");c.href=n,c.download=l,document.body.appendChild(c),c.click(),document.body.removeChild(c)};function F(l,t){const a=JSON.stringify(l,null,2),e=new Blob([a],{type:"application/json"}),r=URL.createObjectURL(e);let o=t+".json";const n=document.createElement("a");n.href=r,n.setAttribute("download",o),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}function V(l,t){var a=new Blob([l],{type:"text/plain"}),e=URL.createObjectURL(a),r=document.createElement("a");let o=t+".txt";r.href=e,r.download=o,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(e)}return(l,t)=>{const a=m("el-cascader"),e=m("el-form-item"),r=m("el-input"),o=m("el-radio"),n=m("el-radio-group"),c=m("el-button");return U(),k("div",null,[p(e,{label:"导出信号选择",prop:"signal"},{default:u(()=>[p(a,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=s=>d.value=s),placeholder:"请选择需要导出数据的信号",options:g.value,onChange:S,props:{multiple:!0},"collapse-tags":"","collapse-tags-tooltip":""},null,8,["modelValue","options"])]),_:1}),p(e,{label:"导出文件名",prop:"signal"},{default:u(()=>[p(r,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=s=>f.value=s),style:{width:"200px","margin-left":"11px"},placeholder:"输入导出文件名"},null,8,["modelValue"])]),_:1}),p(e,{label:"导出文件格式选择",prop:"exportFile"},{default:u(()=>[p(n,{modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=s=>h.value=s)},{default:u(()=>[p(o,{label:1},{default:u(()=>[y("csv")]),_:1}),p(o,{label:2},{default:u(()=>[y("txt")]),_:1}),p(o,{label:3},{default:u(()=>[y("json")]),_:1})]),_:1},8,["modelValue"])]),_:1}),N("div",R,[p(c,{type:"primary",onClick:T},{default:u(()=>[y("导出")]),_:1})])])}}};export{I as default};
