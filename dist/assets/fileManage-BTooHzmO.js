import{_ as _e,a as ce,b as de,c as pe,d as re,e as ge,f as ue,g as fe,h as ve,i as be,j as me,k as he,l as ye,m as Ie,n as xe,o as we,p as je,q as ke,r as Ne,s as Ce,t as Se,u as Fe,v as Be,w as Ve,x as De,y as Ue,z as Le,A as Me,B as Oe,C as Te,D as ze,E as Pe,F as Re,G as $e,H as qe,I as Ae,J as Ee,K as He,L as Je}from"./缩小-KeAYSmN5.js";import{_ as We,V as $,r as d,X as Ge,d as p,H as Ke,o as B,c as q,m as n,e as s,f as o,p as V,h as c,F as M,L as Qe,M as Xe,l as A,A as E,I as D,J as O,q as H,s as Ye,t as Ze,a5 as et,a6 as tt,a7 as at}from"./index-BjGPYSck.js";import st from"./upload-BZ61Scj1.js";import{l as lt,r as ot,s as nt,a as it,g as _t}from"./upload-Bs9C8lXp.js";import ct from"./uploadProgress-DxSEQ6Mm.js";const T=x=>(Ye("data-v-00d771ea"),x=x(),Ze(),x),dt={class:"app-container"},pt={style:{height:"45px","margin-bottom":"20px","border-bottom":"1px solid #ccccdd","padding-bottom":"10px"}},rt={class:"inputBtn"},gt={style:{display:"flex","flex-direction":"row"}},ut=["src"],ft=T(()=>n("span",null,"播放本地文件",-1)),vt=T(()=>n("span",null,"正在传输",-1)),bt=["onClick"],mt={style:{display:"flex","align-items":"center"}},ht=["src"],yt={style:{display:"flex","flex-direction":"row"}},It=["src"],xt={class:"progress-position"},wt={class:"progress-title"},jt=T(()=>n("span",null,"上传进度",-1)),kt={__name:"fileManage",setup(x){const w=$("eventBus");d(null);const m=d(!1),j=d([]),U=d(!1),u=d({}),f=d(["文件"]),i=d(""),v=d(0),h=d(!1),k=d(""),N=d(!0);w.on("uploadStart",a=>{m.value=!1,h.value=!0,v.value++}),w.on("finish",()=>{v.value>0&&v.value--}),Ge(()=>{C(!1)});let L=$("$modal");function C(a){U.value=!0,lt(i.value).then(e=>{U.value=!1,e.data.path!="/"&&(i.value=e.data.path);let t=e.data.path.split("/");t[t.length-2]!=""&&!a&&f.value.push(t[t.length-2]),j.value=e.data.file,e.data.file.forEach(l=>{l.objectName.slice(-1)=="/"&&(l.objectName=l.objectName.slice(0,-1))})})}function J(a){if(a==0)i.value="",f.value=["文件"];else{i.value="";for(let e=1;e<a+1;e++)i.value=i.value+f.value[e]+"/";f.value=f.value.slice(0,a)}C(!1)}function z(){j.value=[],C(!0)}function W(a){a.type=="folder"&&(i.value==""?i.value=a.objectName:i.value=i.value+a.objectName,console.log("query:",i.value),C(!1))}function G(a){u.value=a,console.log("勾选：",u.value)}function K(a){return a=="file"?S("文件_2.png"):S("文件夹.png")}function S(a){return new URL(Object.assign({"../../../assets/dataIcons/back.png":_e,"../../../assets/dataIcons/back_2.png":ce,"../../../assets/dataIcons/bev.png":de,"../../../assets/dataIcons/boundary_bev.png":pe,"../../../assets/dataIcons/car.png":re,"../../../assets/dataIcons/l1.png":ge,"../../../assets/dataIcons/l2.png":ue,"../../../assets/dataIcons/l3.png":fe,"../../../assets/dataIcons/laser.png":ve,"../../../assets/dataIcons/play.png":be,"../../../assets/dataIcons/setting.jpeg":me,"../../../assets/dataIcons/sgmwlogo.png":he,"../../../assets/dataIcons/videoImg.png":ye,"../../../assets/dataIcons/videoImg1.png":Ie,"../../../assets/dataIcons/videoImg（复件）.png":xe,"../../../assets/dataIcons/volume.png":we,"../../../assets/dataIcons/volume2.png":je,"../../../assets/dataIcons/volumeCross.png":ke,"../../../assets/dataIcons/volumeDisable.png":Ne,"../../../assets/dataIcons/压缩包.png":Ce,"../../../assets/dataIcons/右下角(1).png":Se,"../../../assets/dataIcons/右下角(2).png":Fe,"../../../assets/dataIcons/右下角.png":Be,"../../../assets/dataIcons/导出.png":Ve,"../../../assets/dataIcons/开始.png":De,"../../../assets/dataIcons/播放(1).png":Ue,"../../../assets/dataIcons/播放.png":Le,"../../../assets/dataIcons/放大.png":Me,"../../../assets/dataIcons/数据库(1).png":Oe,"../../../assets/dataIcons/数据库(2).png":Te,"../../../assets/dataIcons/数据库(3).png":ze,"../../../assets/dataIcons/数据库.png":Pe,"../../../assets/dataIcons/数据库_2.png":Re,"../../../assets/dataIcons/文件.png":$e,"../../../assets/dataIcons/文件_2.png":qe,"../../../assets/dataIcons/文件夹.png":Ae,"../../../assets/dataIcons/暂停.png":Ee,"../../../assets/dataIcons/添加标签.png":He,"../../../assets/dataIcons/缩小.png":Je})[`../../../assets/dataIcons/${a}`],import.meta.url).href}function Q(a){let e={type:"local",src:a.target.files};w.emit("files",e)}const X=a=>et({url:a,method:"get",responseType:"blob",headers:{Authorization:"Bearer "+tt()}}).then(e=>{console.log(e);const t=e.headers["content-disposition"];if(!e||!t){error(e.message||"下载失败！");return}if(e&&e.status===200&&e.data){const{data:l,headers:r}=e,g=new Blob([l],{type:r["content-type"]});let y=r["content-disposition"].split("filename=")[1];at.saveAs(g,y)}}).catch(e=>{});async function Y(){if(u.value.length==0)L.msgWarning("请选择下载的文件");else for(let a=0;a<u.value.length;a++){let e=u.value[a].objectName,t=i.value+e,l="";u.value[a].type=="file"?l="/prod-api/data/fileUpload/v1/download?fileName="+t:l="/prod-api/data/fileUpload/v1/downloadMultiFileToMinIO?folderName="+t,X(l)}}function P(){if(u.value.length==0)L.msgWarning("请选择删除的文件");else{let a=[];for(let e=0;e<u.value.length;e++){let t={...u.value[e]};t.objectName=i.value+t.objectName,a.push(t)}ot(a).then(e=>{e.code==200&&(L.msgSuccess("文件/文件夹删除成功"),z())})}}function R(){let a=i.value,e=k.value;nt(a,e).then(t=>{for(let l=0;l<t.data.length;l++){let r=t.data[l].objectName;r.slice(-1)=="/"&&(t.data[l].objectName=r.slice(0,r.length-1)),a!="/"&&(t.data[l].objectName=t.data[l].objectName.slice(a.length,t.data[l].objectName.length))}j.value=t.data})}function Z(a){let e=i.value+a.objectName;it(e).then(async t=>{let l=[];for(let g=0;g<t.data.length;g++)t.data[g].type=="file"&&await _t(t.data[g].objectName).then(b=>{console.log("FFF",t.data[g].objectName,b.data);let y={fileSrc:b.data,objectName:t.data[g].objectName};l.push(y)});let r={type:"server",src:l};w.emit("files",r)})}function ee(){m.value=!0}function te(){h.value=!h.value}function ae(){h.value=!1}return(a,e)=>{const t=p("el-button"),l=p("el-col"),r=p("el-badge"),g=p("right-toolbar"),b=p("el-row"),y=p("el-breadcrumb-item"),se=p("el-breadcrumb"),le=p("el-input"),I=p("el-table-column"),oe=p("el-table"),ne=p("el-dialog"),ie=Ke("loading");return B(),q("div",dt,[n("div",pt,[s(b,{span:1,type:"flex",justify:"space-between"},{default:o(()=>[s(l,{span:10},{default:o(()=>[s(t,{style:{"margin-right":"20px"},type:"primary",icon:"Upload",onClick:ee},{default:o(()=>[V("上传")]),_:1}),s(t,{style:{"margin-right":"30px"},type:"primary",icon:"Download",onClick:Y},{default:o(()=>[V("下载")]),_:1}),n("span",rt,[n("div",gt,[n("img",{src:S("play.png"),style:{width:"16px",height:"16px","margin-right":"5px","margin-top":"2px"}},null,8,ut),ft]),n("input",{class:"inputFile",type:"file",webkitdirectory:"",directory:"",onChange:Q},null,32)])]),_:1}),s(l,{span:2,offset:10,style:{display:"flex","justify-content":"flex-end"}},{default:o(()=>[s(t,{style:{"margin-right":"30px"},type:"danger",icon:"Delete",onClick:P},{default:o(()=>[V("删除")]),_:1}),s(t,{style:{"margin-right":"30px"},type:"primary",disabled:c(v)==0,plain:"",icon:"Switch",onClick:te},{default:o(()=>[vt,s(r,{style:{position:"relative",float:"right","margin-left":"5px"},value:c(v),hidden:c(v)==0,min:1,max:99},null,8,["value","hidden"])]),_:1},8,["disabled"])]),_:1}),s(l,{span:2,style:{display:"flex","justify-content":"flex-end"}},{default:o(()=>[s(g,{showSearch:c(N),"onUpdate:showSearch":e[0]||(e[0]=_=>M(N)?N.value=_:null),onQueryTable:z},null,8,["showSearch"])]),_:1})]),_:1})]),s(b,null,{default:o(()=>[s(l,{span:18},{default:o(()=>[s(se,{separator:"〉",class:"breadcrumb_bg"},{default:o(()=>[(B(!0),q(Qe,null,Xe(c(f),(_,F)=>(B(),A(y,{key:F},{default:o(()=>[n("a",{style:{"font-weight":"bold"},onClick:Nt=>J(F)},E(_),9,bt)]),_:2},1024))),128))]),_:1})]),_:1}),s(l,{span:6,style:{display:"flex","justify-content":"flex-end"}},{default:o(()=>[D(n("div",null,[s(le,{modelValue:c(k),"onUpdate:modelValue":e[1]||(e[1]=_=>M(k)?k.value=_:null),onBlur:R,style:{width:"200px",height:"25px"},placeholder:"请输入"},null,8,["modelValue"]),s(t,{type:"primary",onClick:R,style:{height:"25px"}},{default:o(()=>[V("搜索")]),_:1})],512),[[O,c(N)]])]),_:1})]),_:1}),D((B(),A(oe,{id:"table",data:c(j),"max-height":"700",onSelect:G,onRowClick:W,style:{width:"100%"}},{default:o(()=>[s(I,{type:"selection",width:"55",align:"center"}),s(I,{prop:"objectName",label:"文件",width:"800px",sortable:""},{default:o(_=>[n("div",mt,[n("img",{src:K(_.row.type),style:{width:"20px",height:"20px","margin-right":"10px"}},null,8,ht),n("span",null,E(_.row.objectName),1)])]),_:1}),s(I,{prop:"totalSize",label:"大小",sortable:""}),s(I,{prop:"time",label:"时间",sortable:""}),s(I,{prop:"time",label:"操作",width:"180px"},{default:o(_=>[n("div",yt,[D(s(t,{onClick:H(F=>Z(_.row),["stop"]),style:{width:"25px",height:"25px",border:"none"}},{default:o(()=>[n("img",{src:S("播放(1).png"),style:{width:"15px",height:"15px"}},null,8,It)]),_:2},1032,["onClick"]),[[O,c(f).length==4]]),s(t,{style:{width:"25px",height:"25px",border:"none",color:"#f56c6c","font-size":"18px"},icon:"Delete",onClick:H(F=>P(_.row),["stop"])},null,8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ie,c(U)]]),D(n("div",xt,[n("div",wt,[jt,s(t,{icon:"CircleClose",style:{border:"none","font-size":"20px",padding:"0px"},onClick:ae})]),s(ct)],512),[[O,c(h)]]),s(ne,{title:"文件上传",modelValue:c(m),"onUpdate:modelValue":e[2]||(e[2]=_=>M(m)?m.value=_:null),width:"500px","append-to-body":""},{default:o(()=>[s(st)]),_:1},8,["modelValue"])])}}},Dt=We(kt,[["__scopeId","data-v-00d771ea"]]);export{Dt as default};
