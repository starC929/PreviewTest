import{i as Y}from"./index-DnlKIcX7.js";/* empty css                                              */import{r as c,Y as q,a9 as G,V as J,X as j,Z as H,w as P,d as K,o as Q,c as W,m as A,e as $,a3 as z}from"./index-BjGPYSck.js";import{c as B}from"./upload-Bs9C8lXp.js";const R={style:{"margin-top":"1px",display:"flex","flex-direction":"row"}},ee={id:"chartsPart",style:{display:"flex","flex-direction":"column"}},ae=["id"],re={__name:"echart",props:["videoTime","chartId","divSize","frameTag","currentFrame","fileId"],setup(L){const X={multiple:!0},n=L;c([]),c([]);for(let e=0;e<parseInt(n.videoTime.total);e++);let u=null;c(0),c(0),c("");const D=c([]),f=c([]);c(1),c([{label:"0.5倍速",value:.5},{label:"1倍速",value:1},{label:"1.5倍速",value:1.5},{label:"2倍速",value:2}]);const r=c([]);n.chartId==="can-1"&&(r.value=q().getPlaySet().signal);const o=[];let _={},I=!1,m=c({animation:!1,dataZoom:[{type:"inside",xAxisIndex:[0,1]}],legend:{data:[],type:"scroll",width:"85%"},tooltip:{show:!0,trigger:"axis"},xAxis:[],yAxis:[],series:[]});const v=c({width:"300",height:"225"});if(G(()=>{n.divSize&&u!=null&&(v.value.width=String(n.divSize.width),v.value.height=String(n.divSize.height-30),u.resize())}),n.frameTag)for(var C in n.frameTag){let e={xAxis:n.frameTag[C].timeFrame,label:{formatter:n.frameTag[C].labelName}};o.push(e)}if(n.currentFrame){let e={xAxis:n.currentFrame,label:{formatter:"当前位置"}};o.push(e)}const h=J("eventBus");h.on("currentFrame",e=>{k(e)}),h.on("markLineLabelData",e=>{console.log("get-markLineLabelData",e),o.length>0&&o[o.length-1].label.formatter==="当前位置"&&(_=o[o.length-1],I=!0),o.length=0;for(var a in e){let t={xAxis:e[a].timeFrame,label:{formatter:e[a].labelName}};o.push(t)}I&&o.push(_),y(o)}),j(()=>{const e=document.getElementById(n.chartId);u=Y(e);let a="EgoVehicleCanInfo";B(a).then(async t=>{let l=[];for(var i in t.data[0].data)t.data[0].data.hasOwnProperty(i)&&i!=="stamp"&&i!=="seq"&&l.push({value:i,label:i});for(var s in f.value)f.value[s].label===a&&(f.value[s].children=l)}).catch(t=>{alert("获取消息列表失败，请联系管理员!"),console.error("There was an error in getTopicData!",t)}),u.on("click",function(t){h.emit("addLabel",t.data[0])}),u.getZr().on("click",function(t){let l=[t.offsetX,t.offsetY];if(u.containPixel("grid",l)){let i=u.convertFromPixel({seriesIndex:0},l),s=U(D.value,i[0]);h.emit("addLabel",s)}}),E()}),H(()=>{h.off("ws-message")});let b=!1;P(r,(e,a)=>{b=!0,E()});function Z(){let e=[];r.value.forEach(a=>{e.push(a[0])}),e=Array.from(new Set(e)),e.length!==0?f.value.forEach(a=>{e[0]!==a.label&&(a.disabled=!0)}):f.value.forEach(a=>{a.disabled=!1})}let g=[],w=c(!1);h.on("ws-message",e=>{e.msg==="DDS_Message"&&(w.value=!1,g.push(e.data)),e.msg==="DDS_END"&&(w.value=!0)}),P(w,(e,a)=>{console.log("ddsData333",g);let t=[],l=[];for(var i in g)t.push(g[i].topicType);l=Array.from(new Set(t)),console.log("topicArr",l);for(var i in l){let d={value:l[i],label:l[i],disabled:!1,children:[]};f.value.push(d),t.indexOf(l[i])}});async function E(){let e=[],a=[];b&&(u.clear(),b=!1);let t=[],l=[],i=[];for(var s in r.value)r.value[s].length===2&&(i.push(r.value[s][0]),t.push(r.value[s][1]));l=Array.from(new Set(i));for(var d in l)await B(l[0]).then(p=>{e.push({topicName:l[d],topicData:p.data})}).catch(p=>{alert("获取主题数据失败，请联系管理员!"),console.error("There was an error in getTopicData!",p)});let N,O;for(var x in r.value)if(r.value[x].length===2){let p=l.indexOf(r.value[x][0]),S=e[p].topicData.length,F=[];N=Math.floor(e[p].topicData[0].timestamp/1e6),O=Math.floor(e[p].topicData[S-1].timestamp/1e6);for(var d in e[p].topicData)F.push(Math.floor(e[p].topicData[d].timestamp/1e6));D.value=F;let M=[];for(var d in e[p].topicData){let T=[];T.push(D.value[d]),T.push(Number(e[p].topicData[d].data[r.value[x][1]])),M.push(T)}a.push({topicName:r.value[s][0],sigName:r.value[x][1],sigData:M})}let V=[];if(a.length===0)m.value.yAxis={scale:!0,type:"value",axisLine:{show:!0},min:0,max:100};else{for(var s in a){let S={name:a[s].sigName,type:"line",showSymbol:!1,data:a[s].sigData};V.push(S)}m.value.yAxis={scale:!0,type:"value"}}m.value.xAxis={type:"value",min:N,max:O},m.value.legend.data=t,m.value.series=V,u.setOption(m.value),y(o)}function k(e){let a={xAxis:e,label:{formatter:"当前位置"}};o.length>0&&o[o.length-1].label.formatter==="当前位置"&&o.pop(),o.push(a),y(o)}function y(e){u.setOption({series:[{markLine:{symbol:"none",lineStyle:{color:"black"},data:e}}]})}function U(e,a){let t=e[0],l=Math.abs(t-a);for(let i=1;i<e.length;i++){const s=Math.abs(e[i]-a);s<l&&(t=e[i],l=s)}return t}return(e,a)=>{const t=K("el-cascader");return Q(),W("div",null,[A("div",R,[A("div",ee,[$(t,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=l=>r.value=l),placeholder:"请选择显示信号",options:f.value,props:X,onChange:Z,"collapse-tags":"","collapse-tags-tooltip":"",clearable:"",style:z({position:"relative",width:v.value.width+"px"})},null,8,["modelValue","options","style"]),A("div",{id:n.chartId,style:z({width:v.value.width+"px",height:v.value.height+"px"})},null,12,ae)])])])}}};export{re as default};
